{"version":3,"file":"index.js","sources":["src/PropFilter.mjs"],"sourcesContent":["'use strict';\r\n\r\nimport typechecker from 'typechecker/source/index';\r\nimport * as trim from 'php-trim-plus';\r\nimport deepmerge from 'deepmerge';\r\nimport getProp from 'lodash/get';\r\nimport setProp from 'lodash/set';\r\nimport hasProp from 'lodash/has';\r\n\r\nconst isArray = Array.isArray;\r\n\r\nexport default class PropFilter {\r\n\r\n\tconstructor(filters, target) {\r\n\t\tif (typeof this.filters === 'undefined' || !this.isObject(this.filters))\r\n\t\t\tthis.filters = {};\r\n\t\tif (typeof this.target === 'undefined' || !this.isValidTarget(this.target))\r\n\t\t\tthis.target = null;\r\n\r\n\t\tif (target)\r\n\t\t\tthis.attach(target);\r\n\r\n\t\tif (filters)\r\n\t\t\tthis.setFilters(filters);\r\n\t}\r\n\r\n\tsetFilters(filters) {\r\n\t\tif (this.isFunction(filters)) filters = filters.call(this, this);\r\n\t\tif (!this.isEmptyObject(filters))\r\n\t\t\tthis.filters = deepmerge(this.filters, filters);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tisValidTarget(target) {\r\n\t\treturn this.isObject(target);\r\n\t}\r\n\r\n\tverifyTarget() {\r\n\t\tif (!this.isAttached())\r\n\t\t\tthrow new Error('filter is not attached to a target!');\r\n\t\treturn this.target;\r\n\t}\r\n\r\n\tattach(target) {\r\n\t\tif (this.isValidTarget(target))\r\n\t\t\tthis.target = target;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tunattach() {\r\n\t\tthis.target = null;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tisAttached(target) {\r\n\t\tif (target) return this.target === target;\r\n\t\treturn this.isValidTarget(this.target);\r\n\t}\r\n\r\n\tconvertPropName(prop) {\r\n\t\tif (this.isArray(prop))\r\n\t\t\tprop = prop.join('.');\r\n\t\tif (!this.isString(prop))\r\n\t\t\tthrow new Error('filter prop should be an array or a string!');\r\n\t\treturn prop.replace(/\\[([^\\[\\]]+)\\]/g, (all, inner) => {\r\n\t\t\treturn '.' + inner;\r\n\t\t});\r\n\t}\r\n\r\n\tfilter(target, method, prop, value = undefined) {\r\n\t\tconst filter = this.filters[this.convertPropName(prop)];\r\n\t\tswitch (method.toLowerCase()) {\r\n\t\t\tcase 'get' :\r\n\t\t\t\tvalue = getProp(target, prop, value);\r\n\t\t\t\tif (filter && filter.get && typeof filter.get === 'function') {\r\n\t\t\t\t\tvalue = filter.get.call(this, value, target, prop, filter);\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\tcase 'set' :\r\n\t\t\t\tif (filter && filter.set && typeof filter.set === 'function') {\r\n\t\t\t\t\tvalue = filter.set.call(this, value, target, prop, filter);\r\n\t\t\t\t}\r\n\t\t\t\tsetProp(target, prop, value);\r\n\t\t\t\treturn this;\r\n\t\t\tcase 'has' :\r\n\t\t\t\tconst has = hasProp(target, prop);\r\n\t\t\t\tif (filter && filter.has && typeof filter.has === 'function') {\r\n\t\t\t\t\treturn !!filter.has.call(this, target[prop], has, target, prop, filter);\r\n\t\t\t\t}\r\n\t\t\t\treturn has;\r\n\t\t\tdefault :\r\n\t\t\t\tthrow new Error('unknown filter method!');\r\n\t\t}\r\n\t}\r\n\r\n\thas(prop) {\r\n\t\treturn this.filter(this.verifyTarget(), 'has', prop);\r\n\t}\r\n\r\n\tget(prop, value = undefined) {\r\n\t\treturn this.filter(this.verifyTarget(), 'get', prop, value);\r\n\t}\r\n\r\n\tset(prop, value) {\r\n\t\treturn this.filter(this.verifyTarget(), 'set', prop, value);\r\n\t}\r\n\r\n\ttoSafeString(str) {\r\n\t\treturn trim.toSafeString(str);\r\n\t}\r\n\r\n\ttrim(str, charList, isPlus) {\r\n\t\treturn trim.trim(str, charList, isPlus);\r\n\t}\r\n\r\n\tltrim(str, charList, isPlus) {\r\n\t\treturn trim.ltrim(str, charList, isPlus);\r\n\t}\r\n\r\n\trtrim(str, charList, isPlus) {\r\n\t\treturn trim.rtrim(str, charList, isPlus);\r\n\t}\r\n\r\n\tgetType(value) {\r\n\t\treturn typechecker.getType(value);\r\n\t}\r\n\r\n\tisNothing(value) {\r\n\t\treturn typeof value === 'undefined' || value === null;\r\n\t}\r\n\r\n\tisNotNothing(value) {\r\n\t\treturn !this.isNothing(value);\r\n\t}\r\n\r\n\tisUndefined(value) {\r\n\t\treturn typeof value === 'undefined';\r\n\t}\r\n\r\n\tisNotUndefined(value) {\r\n\t\treturn !this.isUndefined(value);\r\n\t}\r\n\r\n\tisFunction(value) {\r\n\t\t// return typechecker.isSyncFunction(value);\r\n\t\treturn typeof value === 'function';\r\n\t}\r\n\r\n\tisObject(value) {\r\n\t\treturn typechecker.isObject(value);\r\n\t}\r\n\r\n\tisPlainObject(value) {\r\n\t\treturn typechecker.isPlainObject(value);\r\n\t}\r\n\r\n\tisEmptyObject(value) {\r\n\t\treturn typechecker.isEmptyObject(value);\r\n\t}\r\n\r\n\tisArray(value) {\r\n\t\treturn isArray(value);\r\n\t}\r\n\r\n\tisEmptyArray(value) {\r\n\t\tif (!this.isArray(value)) return false;\r\n\t\treturn value.length <= 0;\r\n\t}\r\n\r\n\tisString(value) {\r\n\t\treturn trim.isString(value);\r\n\t}\r\n\r\n\tisEmptyString(value) {\r\n\t\treturn trim.isEmptyString(value);\r\n\t}\r\n\r\n\tisEmptyStringOrWhitespace(value) {\r\n\t\treturn trim.isEmptyStringOrWhitespace(value);\r\n\t}\r\n\r\n\tisNumber(value) {\r\n\t\treturn typechecker.isNumber(value);\r\n\t}\r\n\r\n\tisStringNumber(value) {\r\n\t\tif (this.isNumber(value)) return true;\r\n\t\treturn !!(!this.isEmptyString(value) && value.match(/^\\-?([\\d]*\\.?[\\d]+|(0x)?[a-f0-9]+)$/i));\r\n\t}\r\n\r\n\tisBoolean(value) {\r\n\t\treturn typechecker.isBoolean(value);\r\n\t}\r\n\r\n\tisRegExp(value) {\r\n\t\treturn typechecker.isRegExp(value);\r\n\t}\r\n\r\n\tisError(value) {\r\n\t\treturn typechecker.isError(value);\r\n\t}\r\n}"],"names":["isArray","Array","PropFilter","filters","target","isObject","isValidTarget","attach","setFilters","isFunction","call","isEmptyObject","deepmerge","isAttached","Error","prop","join","isString","replace","all","inner","method","value","undefined","filter","convertPropName","toLowerCase","getProp","get","set","setProp","has","hasProp","verifyTarget","str","trim","charList","isPlus","typechecker","getType","isNothing","isUndefined","isPlainObject","length","isNumber","isEmptyString","match","isBoolean","isRegExp","isError"],"mappings":"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"}